<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Harper — Grammar Checker Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --card-bg:#fff;
      --muted:#6b7280;
      --border:#e5e7eb;
      --highlight-bg:#fff9e6;
      --error-border:#ef4444;
    }
    
    * { box-sizing: border-box; }
    
    html,body{
      height:100%;
      margin:0;
      padding:0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:#f9fafb;
      color:#111827;
      line-height:1.6;
    }

    .container{
      display:flex;
      height:100vh;
      overflow:hidden;
    }
    
    .left{
      flex:2;
      padding:24px;
      overflow:auto;
      background:#f9fafb;
    }
    
    .right{
      flex:1;
      padding:24px;
      border-left:1px solid var(--border);
      background:var(--card-bg);
      overflow:auto;
    }

    .card{
      background:var(--card-bg);
      border:1px solid var(--border);
      border-radius:8px;
      padding:24px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1);
    }

    .editor-wrapper{
      position:relative;
      min-height:400px;
    }
    
    .highlight-layer{
      position:absolute;
      top:0;
      left:0;
      right:0;
      padding:0;
      white-space:pre-wrap;
      word-break:break-word;
      pointer-events:none;
      font-size:15px;
      line-height:1.7;
      font-family:inherit;
      color:#111827;
      z-index:1;
      min-height:400px;
      overflow:hidden;
    }

    textarea#maininput{
      position:relative;
      z-index:2;
      width:100%;
      min-height:400px;
      padding:0;
      border:0;
      outline:0;
      resize:none;
      overflow:hidden;
      font-size:15px;
      line-height:1.7;
      font-family:inherit;
      color:transparent;
      caret-color:#111827;
      background:transparent;
    }

    mark.err{
      background:#fef2f2;
      border-bottom:2px solid var(--error-border);
      color:#111827;
      cursor:pointer;
      transition:background 0.15s;
    }
    
    mark.err:hover{
      background:#fee2e2;
    }

    .problems-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }
    
    .problems-header h2{
      margin:0;
      font-size:18px;
      font-weight:600;
      color:#111827;
    }
    
    .problems-header-buttons{
      display:flex;
      gap:8px;
    }
    
    .problems-header button{
      padding:6px 12px;
      font-size:13px;
      border:1px solid var(--border);
      background:white;
      border-radius:6px;
      cursor:pointer;
      color:#374151;
      transition:all 0.15s;
    }
    
    .problems-header button:hover{
      background:#f9fafb;
      border-color:#d1d5db;
    }

    #problemsList{
      display:flex;
      flex-direction:column;
      gap:0;
    }
    
    .problem-card{
      border-bottom:1px solid var(--border);
      padding:16px 0;
      background:transparent;
      cursor:pointer;
      transition:background 0.15s;
    }
    
    .problem-card:first-child{
      padding-top:0;
    }
    
    .problem-card:hover{
      background:#f9fafb;
      margin:0 -12px;
      padding-left:12px;
      padding-right:12px;
      border-radius:6px;
    }
    
    .problem-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:4px;
    }
    
    .problem-type{
      font-weight:600;
      font-size:14px;
      color:#111827;
    }
    
    .problem-chevron{
      color:#9ca3af;
      font-size:18px;
      line-height:1;
      transition:transform 0.2s;
    }
    
    .problem-card.expanded .problem-chevron{
      transform:rotate(180deg);
    }
    
    .problem-message{
      font-size:14px;
      color:var(--muted);
      margin:4px 0 8px 0;
    }
    
    .problem-preview{
      background:#f9fafb;
      padding:8px 10px;
      border-radius:6px;
      font-size:13px;
      color:#111827;
      border-left:3px solid #fbbf24;
      margin:8px 0;
      display:none;
    }
    
    .problem-card.expanded .problem-preview{
      display:block;
    }
    
    .problem-actions{
      display:none;
      margin-top:8px;
      gap:8px;
    }
    
    .problem-card.expanded .problem-actions{
      display:flex;
    }
    
    .btn-fix{
      background:#10b981;
      color:white;
      border:none;
      padding:6px 12px;
      border-radius:6px;
      font-size:13px;
      cursor:pointer;
      font-weight:500;
      transition:background 0.15s;
    }
    
    .btn-fix:hover{
      background:#059669;
    }
    
    .btn-dismiss{
      background:transparent;
      color:#6b7280;
      border:1px solid var(--border);
      padding:6px 12px;
      border-radius:6px;
      font-size:13px;
      cursor:pointer;
      transition:all 0.15s;
    }
    
    .btn-dismiss:hover{
      background:#f9fafb;
    }

    #lintTooltip{
      position:fixed;
      display:none;
      background:#1f2937;
      color:white;
      padding:12px 16px;
      border-radius:8px;
      box-shadow:0 10px 25px rgba(0,0,0,0.3);
      font-size:13px;
      z-index:10000;
      max-width:320px;
    }
    
    .tooltip-title{
      font-weight:600;
      margin-bottom:6px;
      font-size:14px;
    }
    
    .tooltip-message{
      margin-bottom:10px;
      line-height:1.5;
    }
    
    .tooltip-actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    
    .tooltip-btn{
      padding:6px 12px;
      border:none;
      border-radius:6px;
      font-size:12px;
      cursor:pointer;
      font-weight:500;
      transition:all 0.15s;
    }
    
    .tooltip-btn.apply{
      background:#10b981;
      color:white;
    }
    
    .tooltip-btn.apply:hover{
      background:#059669;
    }
    
    .tooltip-btn.dismiss{
      background:#374151;
      color:white;
    }
    
    .tooltip-btn.dismiss:hover{
      background:#4b5563;
    }

    .muted{
      color:var(--muted);
      font-size:14px;
      text-align:center;
      padding:40px 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="left">
    <div class="card">
      <div class="editor-wrapper">
        <div id="highlight" class="highlight-layer" aria-hidden="true"></div>
        <textarea id="maininput" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Start typing..."></textarea>
      </div>
    </div>
  </div>

  <div class="right">
    <div class="problems-header">
      <h2>Problems</h2>
      <div class="problems-header-buttons">
        <button id="openAll">Open all</button>
        <button id="ignoreAll">Ignore all</button>
      </div>
    </div>

    <div id="problemsList"></div>
  </div>
</div>

<div id="lintTooltip"></div>

<script>
  // Simplified linter configuration
  let currentLints = [];
  let expandedProblems = new Set();

  function escapeHTML(str){
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function applyHighlights(text, lints){
    if(!text) return '';
    let html = '';
    let last = 0;
    
    const sortedLints = [...lints].sort((a, b) => a.start - b.start);
    
    for(const l of sortedLints){
      html += escapeHTML(text.slice(last, l.start));
      html += `<mark class="err" data-start="${l.start}" data-end="${l.end}" data-id="${l.id}">${escapeHTML(text.slice(l.start, l.end))}</mark>`;
      last = l.end;
    }
    html += escapeHTML(text.slice(last));
    return html;
  }

  function detectIssues(text){
    const results = [];
    let idCounter = 0;

    // Repeated words
    const repRegex = /\b(\w+)\s+\1\b/gi;
    let match;
    while((match = repRegex.exec(text)) !== null){
      results.push({
        id: idCounter++,
        start: match.index,
        end: match.index + match[0].length,
        type: 'Repetition',
        message: 'Did you mean to repeat this word?',
        text: match[0],
        suggestion: match[1]
      });
    }

    // Common typos
    const typos = {
      'missspelled': 'misspelled',
      'shoul dn\'t': 'shouldn\'t',
      'ned': 'need',
      'aout': 'about',
      'that;s': 'that\'s',
      'thats': 'that\'s',
      'too': 'to',
      'an language': 'a language',
      'an lifesaver': 'a lifesaver',
      'that Grammarly': 'than Grammarly'
    };

    for(const [wrong, right] of Object.entries(typos)){
      const regex = new RegExp('\\b' + wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
      while((match = regex.exec(text)) !== null){
        let type = 'Spelling';
        let message = 'Possible misspelling';
        
        if(wrong.includes('an ') && right.includes('a ')) {
          type = 'Style';
          message = 'Should use "a" instead of "an" before consonant sounds';
        } else if(wrong === 'that Grammarly') {
          type = 'Typo';
          message = 'This looks like a comparison that should use "than" rather than "that"';
        }
        
        results.push({
          id: idCounter++,
          start: match.index,
          end: match.index + match[0].length,
          type: type,
          message: message,
          text: match[0],
          suggestion: right
        });
      }
    }

    // Capitalization issues
    const capRegex = /\.\s+([a-z])/g;
    while((match = capRegex.exec(text)) !== null){
      results.push({
        id: idCounter++,
        start: match.index + 2,
        end: match.index + 3,
        type: 'Capitalization',
        message: 'Sentence should start with a capital letter',
        text: match[1],
        suggestion: match[1].toUpperCase()
      });
    }

    return results;
  }

  function onInput(){
    const ta = document.getElementById('maininput');
    const raw = ta.value;
    currentLints = detectIssues(raw);

    const highlight = document.getElementById('highlight');
    highlight.innerHTML = applyHighlights(raw, currentLints);

    // Add click handlers to marks
    highlight.querySelectorAll('mark.err').forEach(mark => {
      mark.style.pointerEvents = 'auto';
      mark.addEventListener('click', (e) => {
        e.stopPropagation();
        const start = parseInt(mark.dataset.start);
        const end = parseInt(mark.dataset.end);
        const lint = currentLints.find(l => l.start === start && l.end === end);
        if(lint) showTooltip(mark, lint);
      });
    });

    renderProblems();
  }

  function renderProblems(){
    const list = document.getElementById('problemsList');
    list.innerHTML = '';
    
    if(currentLints.length === 0){
      const empty = document.createElement('div');
      empty.className = 'muted';
      empty.textContent = 'No problems found.';
      list.appendChild(empty);
      return;
    }

    currentLints.forEach((lint) => {
      const card = document.createElement('div');
      card.className = 'problem-card';
      if(expandedProblems.has(lint.id)) card.classList.add('expanded');
      
      card.innerHTML = `
        <div class="problem-header">
          <div class="problem-type">${escapeHTML(lint.type)}</div>
          <div class="problem-chevron">›</div>
        </div>
        <div class="problem-message">${escapeHTML(lint.message)}</div>
        <div class="problem-preview">${escapeHTML(lint.text)}</div>
        <div class="problem-actions">
          <button class="btn-fix">${escapeHTML(lint.suggestion)}</button>
          <button class="btn-dismiss">Dismiss</button>
        </div>
      `;

      card.addEventListener('click', (e) => {
        if(e.target.tagName === 'BUTTON') return;
        if(expandedProblems.has(lint.id)){
          expandedProblems.delete(lint.id);
        } else {
          expandedProblems.add(lint.id);
        }
        renderProblems();
      });

      const fixBtn = card.querySelector('.btn-fix');
      fixBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        applyReplacement(lint.start, lint.end, lint.suggestion);
      });

      const dismissBtn = card.querySelector('.btn-dismiss');
      dismissBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentLints = currentLints.filter(l => l.id !== lint.id);
        expandedProblems.delete(lint.id);
        renderProblems();
      });

      list.appendChild(card);
    });
  }

  function applyReplacement(start, end, replacement){
    const ta = document.getElementById('maininput');
    const v = ta.value;
    ta.value = v.slice(0, start) + replacement + v.slice(end);
    autoResize();
    onInput();
    hideTooltip();
  }

  function showTooltip(element, lint){
    const tooltip = document.getElementById('lintTooltip');
    const rect = element.getBoundingClientRect();
    
    tooltip.innerHTML = `
      <div class="tooltip-title">${escapeHTML(lint.type)}</div>
      <div class="tooltip-message">${escapeHTML(lint.message)}</div>
      <div class="tooltip-actions">
        <button class="tooltip-btn apply">${escapeHTML(lint.suggestion)}</button>
        <button class="tooltip-btn dismiss">Dismiss</button>
      </div>
    `;
    
    tooltip.style.display = 'block';
    tooltip.style.top = (rect.bottom + 8) + 'px';
    tooltip.style.left = rect.left + 'px';

    tooltip.querySelector('.apply').onclick = (e) => {
      e.stopPropagation();
      applyReplacement(lint.start, lint.end, lint.suggestion);
    };

    tooltip.querySelector('.dismiss').onclick = (e) => {
      e.stopPropagation();
      hideTooltip();
    };

    setTimeout(() => {
      document.addEventListener('click', hideTooltip, { once: true });
    }, 0);
  }

  function hideTooltip(){
    document.getElementById('lintTooltip').style.display = 'none';
  }

  function autoResize(){
    const ta = document.getElementById('maininput');
    const h = document.getElementById('highlight');
    ta.style.height = 'auto';
    ta.style.height = ta.scrollHeight + 'px';
    h.style.height = ta.scrollHeight + 'px';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const ta = document.getElementById('maininput');
    const hl = document.getElementById('highlight');

    // Sample text
    ta.value = `There are some cases where the the standard grammar checkers don't cut it. That;s where Harper comes in handy.

Harper is an language checker for developers. It can detect improper capitalization and missspelled words, as well as a number of other issues. Like if you break up words you shoul dn't. Harper can be an lifesaver when writing technical documents, emails or other formal forms of communication.

Harper works everywhere, even when you're not online. Since your data never leaves your device, you don't ned too worry aout us selling it or using it to train large language models.

The best part: Harper can give you feedback instantly. For most documents, Harper can serve up suggestions in under 10 ms, faster that Grammarly.`;

    const debounce = (fn, ms = 150) => {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), ms);
      };
    };

    ta.addEventListener('input', debounce(() => {
      autoResize();
      onInput();
    }, 150));

    ta.addEventListener('scroll', () => {
      hl.scrollTop = ta.scrollTop;
      hl.scrollLeft = ta.scrollLeft;
    });

    document.getElementById('openAll').addEventListener('click', () => {
      currentLints.forEach(l => expandedProblems.add(l.id));
      renderProblems();
    });

    document.getElementById('ignoreAll').addEventListener('click', () => {
      currentLints = [];
      expandedProblems.clear();
      renderProblems();
      onInput();
    });

    autoResize();
    onInput();
  });
</script>
</body>
</html>
